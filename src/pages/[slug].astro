---
import type { GetStaticPaths } from 'astro';
import type { Post } from '@utils/types';
import { customTypography, formatDate } from '@utils/scripts';
import { getCollection, render } from 'astro:content';
import ContentWrapper from '@layouts/ContentWrapper.astro';
import GlobalWrapper from '@layouts/GlobalWrapper.astro';
import PageTitle from '@components/PageTitle.astro';
import Tags from '@components/Tags.astro';

export const getStaticPaths = (async () => {
  const posts: Post[] = await getCollection('posts');
  return posts.map((post: Post) => ({
    params: { slug: post.data.permalink },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await render(post);
---

<GlobalWrapper pageTitle={post.data.title}>
  <PageTitle
    slot="title"
    title={post.data.title}
    subtitle={formatDate(post.data.datePublished)}
  />
  <div slot="main" class="content">
    <ContentWrapper>
      <Content components={customTypography} />
    </ContentWrapper>
    <Tags tags={post.data.tags} />
  </div>
</GlobalWrapper>

<style lang="scss">
  .content {
    display: flex;
    flex-direction: column;
    gap: var(--space-30-40);
    max-width: var(--narrow-content);
    padding-top: var(--space-100-160);
  }
</style>
