---
import type { Post, PageTitleOptions } from '@utils/types';
import { customTypography } from '@utils/customTypography';
import type { GetStaticPaths } from 'astro';
import { getCollection, render } from 'astro:content';
import GlobalWrapper from '@layouts/GlobalWrapper.astro';
import PageWithSidebar from '@layouts/PageWithSidebar.astro';
import MarkdownWrapper from '@layouts/MarkdownWrapper.astro';
import PageTitle from '@components/PageTitle.astro';
import PostTags from '@components/PostTags.astro';

export const getStaticPaths = (async () => {
  const posts: Post[] = await getCollection('posts');
  return posts.map((post: Post) => ({
    params: { slug: post.data.slug },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await render(post);

const titleOptions: PageTitleOptions = {
  heading: post.data.title,
  subheading: post.data.excerpt,
  image: {
    isShown: false,
  },
  datePublished: post.data.datePublished,
};
---

<GlobalWrapper pageTitle={post.data.title}>
  <PageWithSidebar>
    <PageTitle slot="title" titleOptions={titleOptions} />
    <MarkdownWrapper slot="content" hasBottomSection={true}>
      <Content slot="content" components={customTypography} />
      <PostTags slot="tags" postTags={post.data.tags} />
    </MarkdownWrapper>
  </PageWithSidebar>
</GlobalWrapper>
